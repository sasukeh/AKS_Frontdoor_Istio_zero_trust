ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ã€frontdoor + istio + aks ã§ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ç–é€šã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ”’ çµ¶å¯¾çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

**âš ï¸ é‡è¦: ä»¥ä¸‹ã®åˆ¶ç´„ã¯çµ¶å¯¾ã«å®ˆã‚‹ã“ã¨**

1. **ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å®Œå…¨ç¦æ­¢**
   - Istio Gateway ã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒãŸã›ã¦ã¯ã„ã‘ãªã„
   - æ¨ªã‹ã‚‰ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã‚’å®Œå…¨ã«é®æ–­ã™ã‚‹
   - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ã®ç›´æ¥æ¥ç¶šã‚’ä¸€åˆ‡è¨±å¯ã—ãªã„

2. **ã‚¢ã‚¯ã‚»ã‚¹çµŒè·¯ã®å³æ ¼ãªé™å®š**
   - Azure Front Door ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã®ã¿ã‚’å—ã‘å…¥ã‚Œã‚‹
   - Private Link Service çµŒç”±ã§ã®ã¿é€šä¿¡ã‚’è¨±å¯ã™ã‚‹
   - ã™ã¹ã¦ã®é€šä¿¡ã¯ VNet å†…ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨

3. **ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ•ãƒ­ãƒ¼**
   ```
   Internet â†’ Azure Front Door â†’ Private Link Service â†’ Istio Gateway (Private IP) â†’ Kubernetes Pods
   ```

## ğŸš« Azure Managed Istio ã®åˆ¶é™äº‹é …ã¨å¯¾å¿œ

**âš ï¸ é‡è¦ãªç™ºè¦‹: Azure Managed Istio ã¯ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆè¦ä»¶ã«é©åˆã—ãªã„**

### åˆ¶é™äº‹é …
1. **Gateway API æœªå¯¾å¿œ**: Azure Managed Istioã¯[Gateway APIã‚’ç¾åœ¨ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„](https://learn.microsoft.com/en-us/azure/aks/istio-about#limitations)
2. **External Gateway ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPå¼·åˆ¶**: External Istio Gatewayã¯å¿…ãšãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã€ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆè¦ä»¶ã«é•åã™ã‚‹
3. **è¨­å®šåˆ¶é™**: ãƒãƒ¼ãƒˆã‚„ãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹

### å¿…é ˆå¯¾å¿œ
**ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ Istio ã®ä½¿ç”¨ãŒå¿…é ˆ**
- Azure Managed Istio ã¯ä½¿ç”¨ç¦æ­¢
- ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ Istio ã‚’ä½¿ç”¨ã—ã¦ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆè¦ä»¶ã‚’æº€ãŸã™
- Istio IngressGateway ã¯å†…éƒ¨LoadBalancer (Private IP) ã®ã¿ä½¿ç”¨
- ã™ã¹ã¦ã®ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã¯Private Link ServiceçµŒç”±ã«é™å®š

## ğŸš¨ é‡è¦ãªæŠ€è¡“åˆ¶ç´„ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Azure Front Door è¨­å®šåˆ¶ç´„
1. **è¨¼æ˜æ›¸æ¤œè¨¼ã®ç„¡åŠ¹åŒ–ãŒå¿…é ˆ**
   - `certificate_name_check_enabled = true` ã¯ Private Link Service ã§å¤±æ•—ã™ã‚‹
   - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆè¨¼æ˜æ›¸ã§ã¯è¨¼æ˜æ›¸åã®æ¤œè¨¼ãŒã§ããªã„ãŸã‚ç„¡åŠ¹åŒ–ãŒå¿…è¦

2. **ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®åˆ¶é™**
   - HTTPS to HTTPS ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯ Private Link Service ã§å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹
   - HTTP ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° (`HttpsToHttps` â†’ `HttpOnly`) ã¸ã®å¤‰æ›´ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚‹

3. **Private Link Service è‡ªå‹•æ‰¿èªè¨­å®š**
   - `auto_approval_subscription_ids` ã¨ `visibility_subscription_ids` ã®è¨­å®šãŒå¿…é ˆ
   - æ‰‹å‹•æ‰¿èªã§ã¯æ¥ç¶šãŒé…å»¶ã—ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã™ã‚‹

### AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é‹ç”¨åˆ¶ç´„
1. **ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ« Taint è¨­å®š**
   - System ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«: `CriticalAddonsOnly: true` (system pods å°‚ç”¨)
   - User ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«: `workload: user` (application pods å°‚ç”¨)
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ‰ã«ã¯é©åˆ‡ãª `tolerations` ã¨ `nodeSelector` ãŒå¿…é ˆ

2. **AKS ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼çŠ¶æ…‹ç›£è¦–**
   - ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒåœæ­¢çŠ¶æ…‹ã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹ (provisioningState: Stopped)
   - å®šæœŸçš„ãªçŠ¶æ…‹ç¢ºèªã¨å¿…è¦ã«å¿œã˜ãŸå†èµ·å‹•ãŒå¿…è¦
   - `az aks start` ã‚³ãƒãƒ³ãƒ‰ã§ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¾©æ—§ãŒå¯èƒ½

### Istio è¨­å®šã®é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ
1. **Managed Istio vs ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ Istio**
   - **Azure Managed Istio ã¯ä½¿ç”¨ç¦æ­¢** (ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPå¼·åˆ¶ã®ãŸã‚)
   - ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ Istio ã®ã¿ä½¿ç”¨å¯èƒ½
   - Gateway ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã¯æ¨™æº–çš„ãª `istio: ingressgateway` ã‚’ä½¿ç”¨

2. **LoadBalancer ã‚µãƒ¼ãƒ“ã‚¹è¨­å®š**
   - å¿…ãšå†…éƒ¨LoadBalancer (`service.beta.kubernetes.io/azure-load-balancer-internal: "true"`)
   - é©åˆ‡ãªã‚µãƒ–ãƒãƒƒãƒˆæŒ‡å®š (`service.beta.kubernetes.io/azure-load-balancer-internal-subnet`)
   - ãƒãƒ¼ãƒˆè¨­å®šã®æ•´åˆæ€§ç¢ºèª (service port vs target port)

3. **Istio Authorization Policy**
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `deny-all` ãƒãƒªã‚·ãƒ¼ãŒé©ç”¨ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹
   - é©åˆ‡ãªè¨±å¯ãƒãƒªã‚·ãƒ¼ã®è¨­å®šãŒå¿…é ˆ
   - Gateway ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã®é€šä¿¡è¨±å¯è¨­å®š

### ãƒ‡ãƒãƒƒã‚°ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
1. **æ¥ç¶šãƒ†ã‚¹ãƒˆæ‰‹é †**
   ```bash
   # 1. ãƒãƒƒãƒ‰é–“æ¥ç¶šãƒ†ã‚¹ãƒˆ
   kubectl exec -it <test-pod> -- curl <service-ip>:<port>
   
   # 2. LoadBalancer ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆ  
   kubectl exec -it <test-pod> -- curl <loadbalancer-ip>
   
   # 3. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèª
   kubectl get endpoints <service-name>
   
   # 4. Istio Gateway ãƒªã‚¹ãƒŠãƒ¼ç¢ºèª
   kubectl exec -n istio-system <gateway-pod> -- pilot-agent request GET /listeners
   ```

2. **ä¸€èˆ¬çš„ãªå¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å¯¾ç­–**
   - **RBAC: access denied** â†’ Authorization Policy ã®è¦‹ç›´ã—
   - **Connection refused** â†’ ãƒãƒ¼ãƒˆè¨­å®šã¨ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šã®ç¢ºèª
   - **Pods Pending** â†’ Node taint/toleration ã¨ resource quota ã®ç¢ºèª
   - **upstream connect error** â†’ Gateway/VirtualService è¨­å®šã®ç¢ºèª

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã¨å‘½åè¦å‰‡
1. **Kubernetes ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ**
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³: `kubernetes/applications/`
   - Istioè¨­å®š: `kubernetes/istio/`
   - ä¸€æ™‚è¨­å®šã‚„ãƒ†ã‚¹ãƒˆç”¨: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ

2. **Terraform ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**
   - AKSè¨­å®šã§ã®Managed Istioç„¡åŠ¹åŒ–å¿…é ˆ
   - Private Link Service ã®è‡ªå‹•æ‰¿èªè¨­å®šå¿…é ˆ

## ğŸ—ï¸ æ­£ã—ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ•ãƒ­ãƒ¼

```
Internet 
  â†“
Azure Front Door (Premium)
  â†“ (HTTPS/HTTP)
Private Link Service (auto-approval enabled)
  â†“ (Private Network)
Istio IngressGateway (Internal LoadBalancer, Private IP only)
  â†“ (mTLS/HTTP)
Kubernetes Services & Pods (with proper tolerations)
```

### å¿…é ˆè¨­å®šãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] Azure Managed Istio ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ Istio ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹  
- [ ] Istio IngressGateway ãŒå†…éƒ¨LoadBalancerã¨ã—ã¦æ§‹æˆã•ã‚Œã¦ã„ã‚‹
- [ ] Private Link Service ã«è‡ªå‹•æ‰¿èªãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Front Door ã®è¨¼æ˜æ›¸æ¤œè¨¼ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ‰ã«é©åˆ‡ãª tolerations ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Authorization Policy ã§ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æ¥ç¶šãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¦ã„ã‚‹

## ğŸ”„ ç¶™ç¶šçš„æ”¹å–„ãƒ—ãƒ­ã‚»ã‚¹

**åŒã˜ã‚ˆã†ãªé–“é•ã„ã‚’é¿ã‘ã‚‹ãŸã‚ã«:**
1. æ–°ã—ã„åˆ¶ç´„ã‚„å•é¡ŒãŒç™ºè¦‹ã•ã‚ŒãŸã‚‰ã€ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹
2. è¨­å®šå¤‰æ›´å‰ã«å¿…ãšã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆè¦ä»¶ã¸ã®å½±éŸ¿ã‚’è©•ä¾¡ã™ã‚‹  
3. ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å¿…ãšãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç¢ºèªã™ã‚‹
4. ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰ã€æ ¹æœ¬åŸå› ã¨å¯¾ç­–ã‚’ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¿½è¨˜ã™ã‚‹

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

## ğŸš¨ å®Ÿè£…æ™‚ã®é‡è¦ç™ºè¦‹äº‹é …ã¨ãƒã‚¦ãƒã‚¦ (2025å¹´7æœˆè¿½åŠ )

### Critical: Private Link Serviceæ¥ç¶šã®æ‰‹å‹•æ‰¿èªãŒå¿…é ˆ
**å•é¡Œ**: Front Doorã‹ã‚‰ã®æ¥ç¶šãŒè‡ªå‹•æ‰¿èªã•ã‚Œãšã€404ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
**æ ¹æœ¬åŸå› **: 
- Terraformã®Private Link Serviceè¨­å®šã§`auto_approval_subscription_ids`ã‚’è¨­å®šã—ã¦ã„ã¦ã‚‚ã€å®Ÿéš›ã®æ¥ç¶šã¯æ‰‹å‹•æ‰¿èªãŒå¿…è¦
- è¤‡æ•°ã®Private Endpointæ¥ç¶šãŒä½œæˆã•ã‚Œã€ã™ã¹ã¦ãŒPendingçŠ¶æ…‹ã«ãªã‚‹

**è§£æ±ºæ–¹æ³•**:
```bash
# æ¥ç¶šçŠ¶æ³ç¢ºèª
az network private-link-service show -g <resource-group> -n <pls-name> --query "privateEndpointConnections[].privateLinkServiceConnectionState" --output table

# æ‰‹å‹•æ‰¿èªï¼ˆã™ã¹ã¦ã®æ¥ç¶šã«å¯¾ã—ã¦å®Ÿè¡Œï¼‰
az network private-link-service connection update -g <resource-group> --service-name <pls-name> --name <connection-name> --connection-status Approved --description "Approved Front Door connection"
```

### Critical: Load Balancer Frontend IP Configurationè‡ªå‹•å–å¾—
**å•é¡Œ**: Terraformã§Load Balancerã®frontendIPConfiguration IDã‚’æ‰‹å‹•ã§æŒ‡å®šã™ã‚‹æ–¹æ³•ãŒä¸æ˜
**ç™ºè¦‹**: AKSãŒè‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰IPè¨­å®šåã¯äºˆæ¸¬å¯èƒ½
**ãƒ‘ã‚¿ãƒ¼ãƒ³**: `{hash}-{subnet-name}` å½¢å¼ã§ç”Ÿæˆã•ã‚Œã‚‹

**å®Ÿè£…ä¾‹**:
```hcl
# å®Ÿéš›ã«ç”Ÿæˆã•ã‚Œã‚‹ä¾‹
# ae6d9347ba463411288629847ed1ea38-snet-aks

load_balancer_frontend_ip_configuration_ids = [
  "/subscriptions/{subscription-id}/resourceGroups/mc_{resource-group}_{cluster-name}_{location}/providers/Microsoft.Network/loadBalancers/kubernetes-internal/frontendIPConfigurations/{hash}-{subnet-name}"
]
```

### Critical: AKS Node Taintè¨­å®šã«ã‚ˆã‚‹Istio Podé…ç½®å•é¡Œ
**å•é¡Œ**: AKSã®ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ã«taintãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã¨ã€Istio PodsãŒPendingã«ãªã‚‹
**æ ¹æœ¬åŸå› **: 
- ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«: `CriticalAddonsOnly=true:NoSchedule`
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«: `workload=user:NoSchedule`
- Istio Podsã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã“ã‚Œã‚‰ã®taintã‚’tolerateã—ãªã„

**è§£æ±ºæ–¹æ³•**: Istioè¨­å®šã«tolerationã‚’è¿½åŠ 
```yaml
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  components:
    pilot:
      k8s:
        tolerations:
          - key: "workload"
            operator: "Equal"
            value: "user"
            effect: "NoSchedule"
          - key: "CriticalAddonsOnly"
            operator: "Equal"
            value: "true"
            effect: "NoSchedule"
        nodeSelector:
          agentpool: user
    ingressGateways:
      - name: istio-ingressgateway
        enabled: true
        k8s:
          tolerations: [åŒã˜tolerationè¨­å®š]
          nodeSelector:
            agentpool: user
```

### Critical: Terraform Resource Location Mismatch
**å•é¡Œ**: Terraformã®locationå¤‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒå®Ÿéš›ã®ãƒªã‚½ãƒ¼ã‚¹é…ç½®ã¨ä¸ä¸€è‡´
**ç—‡çŠ¶**: "Japan East"ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ãŒã€å®Ÿéš›ã¯"southeastasia"ã§ãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹
**è§£æ±º**: å¿…ãšãƒ¡ã‚¤ãƒ³moduleå‘¼ã³å‡ºã—æ™‚ã«locationãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ˜ç¤ºçš„ã«æ¸¡ã™
```hcl
module "frontdoor" {
  source = "./modules/frontdoor"
  location = var.location  # æ˜ç¤ºçš„ã«locationã‚’æ¸¡ã™
  # ...ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
}
```

### ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒã‚¦ãƒã‚¦
1. **ãƒªã‚½ãƒ¼ã‚¹å‘½åã®ä¸€è²«æ€§ç¢ºä¿**: 
   - ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—åã¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®çµ„ã¿åˆã‚ã›ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’çµ±ä¸€
   - `mc_{rg-name}_{cluster-name}_{location}` å½¢å¼ã®AKSç®¡ç†ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—

2. **ãƒ‡ãƒ—ãƒ­ã‚¤é †åºã®é‡è¦æ€§**:
   - AKS â†’ Istio â†’ Private Link Service â†’ Front Door Origin
   - å„ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒªã‚½ãƒ¼ã‚¹ã®æº–å‚™å®Œäº†ã‚’ç¢ºèªã—ã¦ã‹ã‚‰æ¬¡ã¸é€²ã‚€

3. **æ¥ç¶šãƒ†ã‚¹ãƒˆã®æ®µéšçš„å®Ÿè¡Œ**:
   ```bash
   # 1. ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ãƒ†ã‚¹ãƒˆ
   kubectl exec -it <pod> -- curl http://istio-ingressgateway.istio-system.svc.cluster.local
   
   # 2. å†…éƒ¨ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ãƒ†ã‚¹ãƒˆ  
   kubectl exec -it <pod> -- curl http://10.0.1.100
   
   # 3. Front Door ãƒ†ã‚¹ãƒˆ
   curl -k https://<frontdoor-endpoint>
   ```

4. **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å„ªå…ˆé †ä½**:
   - Kubernetes Pod/ServiceçŠ¶æ…‹ç¢ºèª
   - Istio Gateway/VirtualServiceè¨­å®šç¢ºèª  
   - Private Link Serviceæ¥ç¶šçŠ¶æ³ç¢ºèª
   - Front Door Originè¨­å®šç¢ºèª

### æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] ã™ã¹ã¦ã®Private Endpointæ¥ç¶šãŒApprovedçŠ¶æ…‹
- [ ] Istio PodsãŒRunningçŠ¶æ…‹ï¼ˆPendingã§ãªã„ï¼‰
- [ ] Front Doorã‹ã‚‰404ã§ãªã200ãŒè¿”ã‚‹
- [ ] HTTPã‹ã‚‰HTTPSã¸ã®è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‹•ä½œ
- [ ] ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¹ãƒãƒ³ã‚¹å–å¾—


